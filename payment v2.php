<?phpinclude "util/config.php";include "util/functions.php";include "include/header.php";$connect = mysqli_connect($host, $dbid, $dbpass, $dbname);$s_buyer_name  = $_SESSION['s_buyer_name'];$s_buyer_tel_1 = $_SESSION['s_buyer_tel_1'];$s_buyer_tel_2 = $_SESSION['s_buyer_tel_2'];$s_buyer_tel_3 = $_SESSION['s_buyer_tel_3'];?>			<div role="main" class="main">				<section class="page-header page-header-classic page-header-sm">					<div class="container">						<div class="row">							<div class="col-md-8 order-2 order-md-1 align-self-center p-static">								<h1 data-title-border>파쇄비용 결제</h1>							</div>							<div class="col-md-4 order-1 order-md-2 align-self-center">								<ul class="breadcrumb d-block text-md-right">									<li><a href="index.php">Home</a></li>									<li class="active">파쇄비용</li>								</ul>							</div>						</div>					</div>				</section>				<div class="container">					<div class="row mb-4">						<div class="col">							<div class="col mb-5">								<table class="table table-bordered">										<thead>											<tr>												<th style="width: 200px;">													#												</th>												<th>													<h4>결제내용 확인 후 하단의 결제하기 버튼을 눌러주세요</h4>												</th>											</tr>										</thead>										<tbody><?php$query  = "SELECT * FROM billing WHERE buyer_name='$s_buyer_name' AND buyer_tel_2='$s_buyer_tel_2' AND buyer_tel_3='$s_buyer_tel_3' ";$result = mysqli_query($connect, $query);if (mysqli_num_rows($result) > 0) {    for ($i = 0; $row = mysqli_fetch_array($result); $i++) {        $buyer_tel = $row['buyer_tel_1'] . "-" . $row['buyer_tel_2'] . "-" . $row['buyer_tel_3'];        ?>											<tr>												<td>													소속기관명												</td>												<td>													<?php echo $row['company_name']; ?>												</td>											</tr>											<tr>												<td>													파쇄일자												</td>												<td>													<?php echo $row['sdate']; ?>												</td>											</tr>											<tr>												<td>													담당자명												</td>												<td>													<?php echo $row['buyer_name']; ?> 님												</td>											</tr>											<tr>												<td>													연락처												</td>												<td>													<?php echo $buyer_tel; ?>												</td>											</tr>											<tr>												<td>													수거량												</td>												<td>													<?php echo number_format($row['weight']); ?> kg												</td>											</tr>											<tr>												<td>													파쇄비												</td>												<td>													<?php echo number_format($row['amount']); ?> 원 (부가세 포함)												</td>											</tr>											<tr>												<td colspan="2" class="text-center">													<button id="pay_module" class="btn btn-success btn-modern" type="button" style="font-size:16px;">결제하기</button>												</td>											</tr>										</tbody>									</table>								<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>								<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>								<script>									$("#pay_module").click(function () {										var IMP = window.IMP; // 생략가능										IMP.init('imp90017959');										IMP.request_pay({										    // pay_method : 'card', //card(신용카드), trans(실시간계좌이체), vbank(가상계좌), phone(휴대폰소액결제)										    merchant_uid : 'merchant_' + new Date().getTime(), //상점에서 관리하시는 고유 주문번호를 전달										    name : '문서파쇄',										    amount : '<?php echo $row['amount']; ?>',										    buyer_email : '',										    buyer_name : '<?php echo $row['company_name']; ?>',										    buyer_tel : '<?php echo $buyer_tel; ?>'										}, function(rsp) {										    if ( rsp.success ) {										    	//[1] 고객 입장에서 결제가 완료되었고, 아임포트 서버에도 결제완료로 상태가 변경된 상황										    	//가맹점 서버단에서 아임포트 REST API로 결제정보 조회를 위해 imp_uid를 운영하는 서버로 전달하기										    	jQuery.ajax({										    		url: "/payments/complete", //cross-domain error가 발생하지 않도록 주의해주세요										    		type: 'POST',										    		dataType: 'json',										    		data: {											    		imp_uid : rsp.imp_uid											    		//기타 필요한 데이터가 있으면 추가 전달										    		}										    	}).done(function(data) {										    		//[2] 서버에서 REST API로 결제정보확인 후 가맹점 DB에 결제완료로 상태 변경 등 서비스루틴이 정상적인 경우										    		if ( rsp.success ) {										    			var msg = '결제가 완료되었습니다.';										    			msg += '\n고유ID : ' + rsp.imp_uid;										    			msg += '\n상점 거래ID : ' + rsp.merchant_uid;										    			msg += '\n결제 금액 : ' + rsp.paid_amount;										    			msg += '카드 승인번호 : ' + rsp.apply_num;										    			alert(msg);										    		} else {										    			//[3] 아직 제대로 결제가 되지 않았습니다.										    			//[4] 결제된 금액이 요청한 금액과 달라 결제를 자동취소처리하였습니다.										    		}										    	});										    } else {										    	//결제 실패 : error_msg속성에 실패 사유가 전달됨										        var msg = '결제에 실패하였습니다.';										        msg += '에러내용 : ' + rsp.error_msg;										        alert(msg);										    }										});									});								</script>											<?php    }} else {    echo <<<HEREDOC											<tr>												<td colspan="2" class="text-center mt-2 mb-2">													입력된 자료가 없습니다. 당사로 문의바랍니다. (031-8059-3974)												</td>											</tr>										</tbody>									</table>HEREDOC;}?>							</div>						</div>					</div>				</div><!-- // container -->			</div><!-- // main -->			</div><?php include "include/footer.php";?>		</div><?php include "include/script.php";?>	</body></html>